# MetaScan

Projeto monorepo que re√∫ne as aplica√ß√µes backend, mobile e web do MetaScan.

## Tecnologias

- **Backend:** Django + Django REST Framework (Python)
- **Mobile:** Kotlin (Android Studio)
- **Web:** Angular

## Estrutura do reposit√≥rio

```
MetaScan/
  ‚îú‚îÄ‚îÄ backend/   # Backend Django (estrutura modular)
  ‚îú‚îÄ‚îÄ mobile/    # App Android Kotlin
  ‚îú‚îÄ‚îÄ web/       # Frontend Angular
  ‚îú‚îÄ‚îÄ .gitignore
  ‚îî‚îÄ‚îÄ README.md
```

---

## Backend Django - Arquitetura Modular

O backend foi reorganizado em apps Django espec√≠ficos para melhor organiza√ß√£o e manutenibilidade. **Todas as funcionalidades existentes foram preservadas** e organizadas por dom√≠nio.

### üèóÔ∏è Estrutura de Apps:

#### **`core/`** - Configura√ß√µes Globais
- **Responsabilidade**: Usu√°rios, autentica√ß√£o e permiss√µes
- **Modelos**: `CustomUser` (com roles e senha Sankhya criptografada)
- **Views**: `LoginView`, `MeView`, `TokenRefreshView`, `UserViewSet`
- **Funcionalidades**: Autentica√ß√£o JWT, autoriza√ß√£o e gest√£o de usu√°rios

#### **`cavaletes/`** - Gest√£o de Cavaletes
- **Responsabilidade**: Cavaletes e slots
- **Modelos**: `Cavalete`, `Slot`
- **Views**: `CavaleteViewSet` (com todas as actions funcionais)
- **Funcionalidades**: CRUD de cavaletes, exporta√ß√£o Excel, atribui√ß√£o de usu√°rios

#### **`inventory/`** - Auditoria e Hist√≥rico
- **Responsabilidade**: Auditoria e controle de estoque
- **Modelos**: `SlotHistory`, `CavaleteHistory`
- **Views**: `SlotViewSet`, `SlotHistoryViewSet`, `CavaleteHistoryViewSet`
- **Funcionalidades**: Gest√£o de slots, confer√™ncia de estoque, actions bulk

#### **`sankhya/`** - Integra√ß√£o ERP
- **Responsabilidade**: Integra√ß√£o com ERP Sankhya
- **Views**: `ProductConsultView`
- **Servi√ßos**: Autentica√ß√£o, consulta de produtos e estoque
- **Funcionalidades**: Valida√ß√£o de produtos, consulta de estoque em tempo real

#### **`reports/`** - Relat√≥rios (Futuro)
- **Responsabilidade**: Relat√≥rios e an√°lises
- **Funcionalidades**: Dashboards, m√©tricas, exporta√ß√£o

### üìÅ Estrutura de Cada App:
```
app_name/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ admin.py          # Configura√ß√£o do Django Admin
‚îú‚îÄ‚îÄ apps.py           # Configura√ß√£o do app
‚îú‚îÄ‚îÄ models.py         # Modelos de dados
‚îú‚îÄ‚îÄ views.py          # Views da API
‚îú‚îÄ‚îÄ urls.py           # URLs do app
‚îú‚îÄ‚îÄ serializers.py    # Serializers DRF
‚îú‚îÄ‚îÄ services/         # L√≥gica de neg√≥cio
‚îú‚îÄ‚îÄ tests/            # Testes unit√°rios
‚îî‚îÄ‚îÄ migrations/       # Migra√ß√µes do banco
```

### ‚úÖ Funcionalidades Preservadas:
- **Autentica√ß√£o JWT** com integra√ß√£o Sankhya
- **Gest√£o completa de cavaletes** (CRUD, exporta√ß√£o, atribui√ß√£o)
- **Gest√£o de slots** com workflow de confer√™ncia
- **Hist√≥rico completo** de todas as a√ß√µes
- **Integra√ß√£o Sankhya** para valida√ß√£o de produtos
- **Sistema de permiss√µes** por roles (admin, gestor, conferente)
- **Exporta√ß√£o Excel** de dados
- **Actions customizadas** para mudan√ßas de status

### üîó URLs Principais:
- `/cavaletes/` - Gest√£o de cavaletes
- `/slots/` - Gest√£o de slots
- `/slot-history/` - Hist√≥rico de slots
- `/cavalete-history/` - Hist√≥rico de cavaletes
- `/users/` - Gest√£o de usu√°rios
- `/product/<code>/` - Consulta Sankhya
- `/login/` - Autentica√ß√£o
- `/me/` - Dados do usu√°rio logado

**üìñ Para documenta√ß√£o detalhada dos apps, consulte `backend/README_APPS.md`**

---

## Como rodar cada aplica√ß√£o

### Backend (Django)

#### Rodando localmente sem Docker

1. Navegue at√© a pasta `backend/`
2. Crie e ative o ambiente virtual (recomendado):

```bash
python -m venv metascan
source venv/bin/activate  # Linux/Mac
.\venv\Scripts\activate   # Windows PowerShell
```

3. Instale as depend√™ncias:

```bash
pip install -r requirements.txt
```

4. Rode as migrations:

```bash
python manage.py migrate
```

5. Execute o servidor:

```bash
python manage.py runserver
```

---

#### Rodando com Docker

O projeto possui configura√ß√£o para rodar backend, banco de dados Postgres e MinIO via Docker Compose.

1. Crie um arquivo `.env` baseado no `.env.example` (veja se√ß√£o abaixo)
2. Na pasta `backend/` rode:

```bash
docker-compose up --build
```

3. O backend estar√° acess√≠vel em `http://localhost:8000`
4. O MinIO console fica dispon√≠vel em `http://localhost:9001`

---

### Mobile (Android Kotlin)

- Abra a pasta `mobile/` no Android Studio
- Aguarde o Gradle sincronizar
- Rode o app em um emulador ou dispositivo f√≠sico

---

### Web (Angular)

1. Navegue at√© a pasta `web/`
2. Instale as depend√™ncias:

```bash
npm install
```

3. Rode o servidor de desenvolvimento:

```bash
npm start
```

4. Acesse no navegador: `http://localhost:4200`

---

## Integra√ß√£o com ERP Sankhya

Esta aplica√ß√£o possui integra√ß√£o direta com o ERP Sankhya para valida√ß√£o de c√≥digos de produtos e consulta de estoque em tempo real nos diferentes locais de armazenagem.

Isso permite:

- Conferir rapidamente a disponibilidade dos produtos nos cavaletes.
- Atualizar quantidades e locais de armazenagem com precis√£o.
- Evitar erros manuais na confer√™ncia do invent√°rio.
- Otimizar o processo de registro utilizando QR Codes e c√≥digos de barras.

---

## Vari√°veis de ambiente - `.env.example`

Copie o arquivo `.env.example` para `.env` e ajuste os valores conforme seu ambiente:

```
# Configura√ß√£o do banco Postgres
DB_NAME=metascan_db
DB_USER=metascan_user
DB_PASSWORD=metascan_pass

# Configura√ß√£o MinIO
MINIO_ACCESS_KEY=minioaccesskey
MINIO_SECRET_KEY=miniosecretkey
MINIO_BUCKET=metascan-bucket

# Superusu√°rio Django (ser√° criado automaticamente no container)
DJANGO_SUPERUSER_USERNAME=admin
DJANGO_SUPERUSER_EMAIL=admin@metascan.com
DJANGO_SUPERUSER_PASSWORD=changeme123
```

---

## Fluxo de trabalho

- Branches principais:
    - `main`: branch est√°vel
    - `develop`: branch de desenvolvimento
    - `feature/*`: branches de funcionalidades/etapas
- Organiza√ß√£o das tarefas via **Kanban** no GitHub Projects com colunas:
    - Backlog
    - To Do
    - Doing
    - Done

---

## Contato

Caio Riquelmy ‚Äî [LinkedIn](https://www.linkedin.com/in/caio-riquelmy-a295ba19b/) ‚Äî crosnegocios@hotmail.com

---

*README atualizado em 29/08/2025 para o projeto MetaScan com nova arquitetura modular.*
